var Teamtailor=window.Teamtailor||{};Teamtailor.JobsSource=Teamtailor.JobsSource||function(){"use strict";var n={},a={},d=function(t){var e;return t.apiKey?(e=t.url||"https://api.teamtailor.com/v1/jobs?",e+="api_version=20161108&",e+="include=department,locations&",e+="fields[departments]=name&",e+="fields[locations]=name,city&",t.limit&&(t.limit=Math.min(t.limit,30),e=e+"page[size]="+t.limit+"&"),t.feed?e=e+"filter[feed]="+t.feed+"&":e+="filter[feed]=public&",t.departments&&(e=e+"filter[department]="+t.departments+"&"),t.preselectedDepartment&&(e=e+"filter[department]="+t.preselectedDepartment+"&"),t.preselectedLocation&&(e=e+"filter[locations]="+t.preselectedLocation+"&"),t.locations&&(e=e+"filter[locations]="+t.locations+"&"),e=e+"api_key="+t.apiKey+"&"):(e=t.url||"https://tt.teamtailor.com/api/jobs?",t.limit&&(e=e+"limit="+t.limit+"&"),t.preselectedDepartment&&(e=e+"department_name="+t.preselectedDepartment+"&"),t.departments&&(e=e+"department_id="+t.departments+"&"),t.locations&&(e=e+"location_id="+t.locations+"&"),t.internalJobs&&(e=e+"internal="+t.internalJobs+"&"),e=e+"company_id="+t.company),e},p=function(t,e){var a,n=!!window.XDomainRequest,i=function(){e(JSON.parse(a.responseText))};n?((a=new window.XDomainRequest).onprogress=function(){return!0},a.onload=i,a.open("GET",t)):((a=new XMLHttpRequest).open("GET",t,!0),a.onreadystatechange=function(){4===this.readyState&&200<=this.status&&this.status<400&&i()}),a.send()},o=function(t,a,n,i){i===undefined&&(i=[]),n.apiKey?p(t,function(t){if(i=i.concat(t.data),t.links&&t.links.next){var e=t.links.next;e+="&api_key="+n.apiKey,o(e+="&api_version=20161108",a,n,i)}else t.data=i,a(t)}):p(t,a)},l=function(t){if(t)for(var e=0;e<t.length;e++)"departments"===t[e].type?n[t[e].id]=t[e]:"locations"===t[e].type&&(a[t[e].id]=t[e])},i=function(t){var e=t.department_name;if(e)return e;if(t.relationships&&t.relationships.department.data){var a=n[t.relationships.department.data.id];if(a)return a.attributes.name}return null},r=function(t){var e=t.location_name;return e||(t.relationships&&t.relationships.locations.data?t.relationships.locations.data.map(function(t){var e=a[t.id];return e?e.attributes.name&&""!==e.attributes.name?e.attributes.name:e.attributes.city:null}).join(", "):null)},s=function(t){var e=i(t);if(!e)return null;var a=document.createElement("span");return a.className="teamtailor-jobs__department",a.textContent!==undefined?a.textContent=e:a.innerText=e,a},m=function(t){var e=r(t);if(!e)return null;var a=document.createElement("span");return a.className="teamtailor-jobs__location",a.textContent!==undefined?a.textContent=e:a.innerText=e,a},c=function(t){var e=document.createElement("span");e.className="teamtailor-jobs__job-info";var a=s(t),n=m(t);return a&&e.appendChild(a),a&&n&&e.appendChild(document.createTextNode(" - ")),n&&e.appendChild(n),e},u=function(t,e){var a,n=document.createElement("a"),i=(a=t.links?t.attributes.internal?t.links["careersite-job-internal-url"]:t.links["careersite-job-url"]:e.internalJobs?t.preview_url:t.url).split("/")[2];a+="?utm_campaign=jobs-widget&utm_source="+i+"&utm_content=jobs&utm_medium=web",n.className="teamtailor-jobs__job-title",n.setAttribute("href",a),e.popup&&n.setAttribute("target","_blank");var r=t.title||t.attributes.title;return n.textContent!==undefined?n.textContent=r:n.innerText=r,n},b=function(t,e){var a=document.createElement("div");return a.className="teamtailor-jobs__job",a.appendChild(u(t,e)),a.appendChild(c(t)),a},f=function(t,e,a){var n,i=t.querySelectorAll(".teamtailor-jobs__job-wrapper")[0];i.innerHTML="",a.apiKey?(n=e.data,l(e.included)):n=e.jobs;for(var r=0;r<n.length;++r)i.appendChild(b(n[r],a))},_=function(t,n,e,a,i){var r=document.createElement("option"),o=document.createElement("select");o.className="teamtailor-jobs__select";var l,s,m=function(t){var e;e="locations"===n?t.attributes?t.attributes.name&&""!==t.attributes.name?t.attributes.name:t.attributes.city:t.name:t.attributes?t.attributes.name:t.name;var a=document.createElement("option");return a.value=t.id,a.innerText=e,a};i.apiKey?(l=t.meta.texts.all,s=t.data):(l=t.text,s=t.items),r.innerText=l,r.value="",o.appendChild(r);for(var c=0;c<s.length;++c)o.appendChild(m(s[c]));o.addEventListener("change",function(t){i[n]=t.target.value,p(d(i),function(t){f(e,t,i)})}),a.appendChild(o)},v=function(e,a,n){var t;n.apiKey?(t=n.url||"https://api.teamtailor.com/v1/"+e+"?api_key="+n.apiKey+"&api_version=20161108","locations"===e?(t=n.url||"https://api.teamtailor.com/v1/locations?api_key="+n.apiKey+"&api_version=20161108",t+="&fields[locations]=name,city"):(t=n.url||"https://api.teamtailor.com/v1/departments?api_key="+n.apiKey+"&api_version=20161108",t+="&fields[departments]=name")):t="https://tt.teamtailor.com/api/"+e+"?company_id="+n.company;var i=document.createElement("div"),r=a.querySelectorAll(".teamtailor-jobs__filters")[0];i.className="teamtailor-jobs__select-wrapper",r.appendChild(i),o(t,function(t){(t.items&&t.items.length||t.data&&t.data.length)&&_(t,e,a,i,n)},n)},y=function(){var t="",e=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");t+=".teamtailor-jobs__job-title { display: block; }",t+=".teamtailor-jobs__job { margin-bottom: 1em; }",t+=".teamtailor-jobs__select-wrapper { float: left; margin: 0 1em 1em 0; }",t+=".teamtailor-jobs__job-wrapper { clear: left; }",a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),e.appendChild(a)};return{init:function(i){i.company||i.apiKey?p(d(i),function(t){var e=i.jobsWidget||document.getElementById("teamtailor-jobs-widget"),a=document.createElement("div");if(a.className="teamtailor-jobs__job-wrapper",e.appendChild(a),f(e,t,i),(i.departmentSelect||i.locationSelect)&&(!i.preselectedDepartment||!i.preselectedLocation)){var n=document.createElement("div");n.className="teamtailor-jobs__filters",e.insertBefore(n,a),i.departmentSelect&&!i.preselectedDepartment&&v("departments",e,i),i.locationSelect&&!i.preselectedLocation&&v("locations",e,i)}}):alert("missing api key")},run:function(){if(!window.TEAMTAILOR_JOB_SCRIPT_LOADED){window.TEAMTAILOR_JOB_SCRIPT_LOADED=!0,y();for(var t=document.querySelectorAll(".teamtailor-jobs-widget"),e=0;e<t.length;++e)Teamtailor.JobsSource.init({company:t[e].getAttribute("data-teamtailor-company"),apiKey:t[e].getAttribute("data-teamtailor-api-key"),limit:t[e].getAttribute("data-teamtailor-limit"),preselectedDepartment:t[e].getAttribute("data-teamtailor-department"),preselectedLocation:t[e].getAttribute("data-teamtailor-location"),popup:t[e].getAttribute("data-teamtailor-popup"),internalJobs:t[e].getAttribute("data-teamtailor-internal-jobs"),feed:t[e].getAttribute("data-teamtailor-feed"),departmentSelect:t[e].getAttribute("data-teamtailor-department-select"),locationSelect:t[e].getAttribute("data-teamtailor-location-select"),jobsWidget:t[e]})}}}}(),"complete"===document.readyState||"interactive"===document.readyState||Teamtailor.JobsSource||Teamtailor.JobsSource.run?Teamtailor.JobsSource.run():document.addEventListener("DOMContentLoaded",Teamtailor.JobsSource.run);
